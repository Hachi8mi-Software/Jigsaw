<!--
  è®¾ç½®è§†å›¾
  åº”ç”¨è®¾ç½®å’Œç”¨æˆ·åå¥½é…ç½®
-->

<template>
  <div class="settings-view">
    <div class="settings-container">
      <h1 class="settings-title">âš™ï¸ åº”ç”¨è®¾ç½®</h1>
      
      <div class="settings-content">
        <!-- æ¸¸æˆè®¾ç½® -->
        <div class="settings-section">
          <h2 class="section-title">ğŸ® æ¸¸æˆè®¾ç½®</h2>
          <div class="settings-grid">
            <div class="setting-item">
              <label class="setting-label">
                <input 
                  v-model="gameSettings.showBackground"
                  type="checkbox"
                  class="setting-checkbox"
                />
                æ˜¾ç¤ºèƒŒæ™¯å‚è€ƒå›¾
              </label>
              <p class="setting-description">åœ¨æ¸¸æˆä¸­æ˜¾ç¤ºåŠé€æ˜çš„åŸå›¾ä½œä¸ºå‚è€ƒ</p>
            </div>
            
            <div class="setting-item">
              <label class="setting-label">
                <input 
                  v-model="gameSettings.showGrid"
                  type="checkbox"
                  class="setting-checkbox"
                />
                æ˜¾ç¤ºç½‘æ ¼è¾…åŠ©çº¿
              </label>
              <p class="setting-description">æ˜¾ç¤ºç½‘æ ¼çº¿å¸®åŠ©å¯¹é½æ‹¼å›¾å—</p>
            </div>
            
            <div class="setting-item">
              <label class="setting-label">
                <input 
                  v-model="gameSettings.autoSnap"
                  type="checkbox"
                  class="setting-checkbox"
                />
                è‡ªåŠ¨å¸é™„
              </label>
              <p class="setting-description">æ‹¼å›¾å—é è¿‘æ­£ç¡®ä½ç½®æ—¶è‡ªåŠ¨å¯¹é½</p>
            </div>
            
            <div class="setting-item">
              <label class="setting-label">
                <input 
                  v-model="gameSettings.enableRotation"
                  type="checkbox"
                  class="setting-checkbox"
                />
                å¯ç”¨æ‹¼å›¾å—æ—‹è½¬
              </label>
              <p class="setting-description">å…è®¸æ—‹è½¬æ‹¼å›¾å—å¢åŠ éš¾åº¦</p>
            </div>
          </div>
        </div>

        <!-- ç•Œé¢è®¾ç½® -->
        <div class="settings-section">
          <h2 class="section-title">ğŸ¨ ç•Œé¢è®¾ç½®</h2>
          <div class="settings-grid">
            <div class="setting-item">
              <label class="setting-label">
                ä¸»é¢˜è‰²å½©
              </label>
              <select v-model="uiSettings.theme" class="setting-select">
                <option value="light">æµ…è‰²ä¸»é¢˜</option>
                <option value="dark">æ·±è‰²ä¸»é¢˜</option>
                <option value="auto">è·Ÿéšç³»ç»Ÿ</option>
              </select>
            </div>
            
            <div class="setting-item">
              <label class="setting-label">
                ç•Œé¢è¯­è¨€
              </label>
              <select v-model="uiSettings.language" class="setting-select">
                <option value="zh-CN">ç®€ä½“ä¸­æ–‡</option>
                <option value="en-US">English</option>
              </select>
            </div>
            
            <div class="setting-item">
              <label class="setting-label">
                åŠ¨ç”»æ•ˆæœ
              </label>
              <select v-model="uiSettings.animations" class="setting-select">
                <option value="full">å®Œæ•´åŠ¨ç”»</option>
                <option value="reduced">å‡å°‘åŠ¨ç”»</option>
                <option value="none">ç¦ç”¨åŠ¨ç”»</option>
              </select>
            </div>
          </div>
        </div>

        <!-- éŸ³æ•ˆè®¾ç½® -->
        <div class="settings-section">
          <h2 class="section-title">ğŸ”Š éŸ³æ•ˆè®¾ç½®</h2>
          <div class="settings-grid">
            <div class="setting-item">
              <label class="setting-label">
                ä¸»éŸ³é‡
              </label>
              <div class="volume-control">
                <input 
                  v-model.number="audioSettings.masterVolume"
                  type="range"
                  min="0"
                  max="100"
                  class="setting-range"
                />
                <span class="volume-value">{{ audioSettings.masterVolume }}%</span>
              </div>
            </div>
            
            <div class="setting-item">
              <label class="setting-label">
                æ¸¸æˆéŸ³æ•ˆ
              </label>
              <div class="volume-control">
                <input 
                  v-model.number="audioSettings.soundEffects"
                  type="range"
                  min="0"
                  max="100"
                  class="setting-range"
                />
                <span class="volume-value">{{ audioSettings.soundEffects }}%</span>
              </div>
            </div>
            
            <div class="setting-item">
              <label class="setting-label">
                <input 
                  v-model="audioSettings.enableSounds"
                  type="checkbox"
                  class="setting-checkbox"
                />
                å¯ç”¨éŸ³æ•ˆ
              </label>
              <p class="setting-description">æ’­æ”¾æ‹¼å›¾æ”¾ç½®å’Œå®ŒæˆéŸ³æ•ˆ</p>
            </div>
          </div>
        </div>

        <!-- æ€§èƒ½è®¾ç½® -->
        <div class="settings-section">
          <h2 class="section-title">âš¡ æ€§èƒ½è®¾ç½®</h2>
          <div class="settings-grid">
            <div class="setting-item">
              <label class="setting-label">
                æ¸²æŸ“è´¨é‡
              </label>
              <select v-model="performanceSettings.renderQuality" class="setting-select">
                <option value="high">é«˜è´¨é‡</option>
                <option value="medium">ä¸­ç­‰è´¨é‡</option>
                <option value="low">ä½è´¨é‡</option>
              </select>
            </div>
            
            <div class="setting-item">
              <label class="setting-label">
                æœ€å¤§æ‹¼å›¾å—æ•°
              </label>
              <select v-model.number="performanceSettings.maxPieces" class="setting-select">
                <option :value="100">100 å—</option>
                <option :value="500">500 å—</option>
                <option :value="1000">1000 å—</option>
                <option :value="2000">2000 å—</option>
              </select>
            </div>
            
            <div class="setting-item">
              <label class="setting-label">
                <input 
                  v-model="performanceSettings.enableGPUAcceleration"
                  type="checkbox"
                  class="setting-checkbox"
                />
                å¯ç”¨GPUåŠ é€Ÿ
              </label>
              <p class="setting-description">ä½¿ç”¨ç¡¬ä»¶åŠ é€Ÿæå‡æ¸²æŸ“æ€§èƒ½</p>
            </div>
          </div>
        </div>

        <!-- æ•°æ®ç®¡ç† -->
        <div class="settings-section">
          <h2 class="section-title">ğŸ’¾ æ•°æ®ç®¡ç†</h2>
          <div class="settings-grid">
            <div class="setting-item">
              <label class="setting-label">
                <input 
                  v-model="dataSettings.autoSave"
                  type="checkbox"
                  class="setting-checkbox"
                />
                è‡ªåŠ¨ä¿å­˜æ¸¸æˆè¿›åº¦
              </label>
              <p class="setting-description">è‡ªåŠ¨ä¿å­˜æ¸¸æˆçŠ¶æ€ï¼Œé¿å…è¿›åº¦ä¸¢å¤±</p>
            </div>
            
            <div class="setting-item">
              <label class="setting-label">
                ä¿å­˜é—´éš”
              </label>
              <select v-model.number="dataSettings.saveInterval" class="setting-select">
                <option :value="30">30 ç§’</option>
                <option :value="60">1 åˆ†é’Ÿ</option>
                <option :value="300">5 åˆ†é’Ÿ</option>
              </select>
            </div>
          </div>
          
          <div class="data-actions">
            <button @click="exportData" class="data-btn">
              ğŸ“¤ å¯¼å‡ºæ•°æ®
            </button>
            <button @click="importData" class="data-btn">
              ğŸ“¥ å¯¼å…¥æ•°æ®
            </button>
            <button @click="clearData" class="data-btn danger">
              ğŸ—‘ï¸ æ¸…é™¤æ‰€æœ‰æ•°æ®
            </button>
          </div>
        </div>

        <!-- å…³äºä¿¡æ¯ -->
        <div class="settings-section">
          <h2 class="section-title">â„¹ï¸ å…³äº</h2>
          <div class="about-info">
            <div class="app-info">
              <h3>æ‹¼å›¾ä¹ - Puzzle Fun</h3>
              <p>ç‰ˆæœ¬: 1.0.0</p>
              <p>åŸºäº Tauri + Vue 3 æ„å»ºçš„è·¨å¹³å°æ‹¼å›¾åº”ç”¨</p>
            </div>
            <div class="about-links">
              <button @click="openGitHub" class="link-btn">
                ğŸ“± GitHub
              </button>
              <button @click="showLicenses" class="link-btn">
                ğŸ“„ å¼€æºè®¸å¯
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- åº•éƒ¨æ“ä½œæŒ‰é’® -->
      <div class="settings-footer">
        <button @click="resetToDefaults" class="footer-btn">
          ğŸ”„ æ¢å¤é»˜è®¤
        </button>
        <button @click="saveSettings" class="footer-btn primary">
          ğŸ’¾ ä¿å­˜è®¾ç½®
        </button>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { reactive, onMounted } from 'vue'

// è®¾ç½®çŠ¶æ€
const gameSettings = reactive({
  showBackground: true,
  showGrid: true,
  autoSnap: true,
  enableRotation: false
})

const uiSettings = reactive({
  theme: 'light',
  language: 'zh-CN',
  animations: 'full'
})

const audioSettings = reactive({
  masterVolume: 70,
  soundEffects: 80,
  enableSounds: true
})

const performanceSettings = reactive({
  renderQuality: 'high',
  maxPieces: 1000,
  enableGPUAcceleration: true
})

const dataSettings = reactive({
  autoSave: true,
  saveInterval: 60
})

// æ–¹æ³•
const saveSettings = () => {
  const settings = {
    game: gameSettings,
    ui: uiSettings,
    audio: audioSettings,
    performance: performanceSettings,
    data: dataSettings
  }
  
  localStorage.setItem('app_settings', JSON.stringify(settings))
  alert('è®¾ç½®å·²ä¿å­˜')
}

const loadSettings = () => {
  try {
    const saved = localStorage.getItem('app_settings')
    if (saved) {
      const settings = JSON.parse(saved)
      Object.assign(gameSettings, settings.game || {})
      Object.assign(uiSettings, settings.ui || {})
      Object.assign(audioSettings, settings.audio || {})
      Object.assign(performanceSettings, settings.performance || {})
      Object.assign(dataSettings, settings.data || {})
    }
  } catch (error) {
    console.error('åŠ è½½è®¾ç½®å¤±è´¥:', error)
  }
}

const resetToDefaults = () => {
  if (confirm('ç¡®å®šè¦æ¢å¤æ‰€æœ‰è®¾ç½®åˆ°é»˜è®¤å€¼å—ï¼Ÿ')) {
    Object.assign(gameSettings, {
      showBackground: true,
      showGrid: true,
      autoSnap: true,
      enableRotation: false
    })
    
    Object.assign(uiSettings, {
      theme: 'light',
      language: 'zh-CN',
      animations: 'full'
    })
    
    Object.assign(audioSettings, {
      masterVolume: 70,
      soundEffects: 80,
      enableSounds: true
    })
    
    Object.assign(performanceSettings, {
      renderQuality: 'high',
      maxPieces: 1000,
      enableGPUAcceleration: true
    })
    
    Object.assign(dataSettings, {
      autoSave: true,
      saveInterval: 60
    })
  }
}

const exportData = () => {
  const data = {
    settings: {
      game: gameSettings,
      ui: uiSettings,
      audio: audioSettings,
      performance: performanceSettings,
      data: dataSettings
    },
    exportDate: new Date().toISOString()
  }
  
  const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' })
  const url = URL.createObjectURL(blob)
  const a = document.createElement('a')
  a.href = url
  a.download = 'puzzle-settings.json'
  document.body.appendChild(a)
  a.click()
  document.body.removeChild(a)
  URL.revokeObjectURL(url)
}

const importData = () => {
  const input = document.createElement('input')
  input.type = 'file'
  input.accept = '.json'
  input.onchange = (e) => {
    const file = (e.target as HTMLInputElement).files?.[0]
    if (file) {
      const reader = new FileReader()
      reader.onload = (e) => {
        try {
          const data = JSON.parse(e.target?.result as string)
          if (data.settings) {
            Object.assign(gameSettings, data.settings.game || {})
            Object.assign(uiSettings, data.settings.ui || {})
            Object.assign(audioSettings, data.settings.audio || {})
            Object.assign(performanceSettings, data.settings.performance || {})
            Object.assign(dataSettings, data.settings.data || {})
            alert('è®¾ç½®å¯¼å…¥æˆåŠŸ')
          }
        } catch (error) {
          alert('å¯¼å…¥å¤±è´¥ï¼Œæ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®')
        }
      }
      reader.readAsText(file)
    }
  }
  input.click()
}

const clearData = () => {
  if (confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰æ•°æ®å—ï¼Ÿè¿™å°†åˆ é™¤æ‰€æœ‰è®¾ç½®ã€æ¸¸æˆè®°å½•å’Œè‡ªå®šä¹‰æ‹¼å›¾ï¼')) {
    if (confirm('æ­¤æ“ä½œæ— æ³•æ’¤é”€ï¼Œç¡®å®šç»§ç»­å—ï¼Ÿ')) {
      localStorage.clear()
      alert('æ‰€æœ‰æ•°æ®å·²æ¸…é™¤')
      location.reload()
    }
  }
}

const openGitHub = () => {
  window.open('https://github.com', '_blank')
}

const showLicenses = () => {
  alert('å¼€æºè®¸å¯ä¿¡æ¯å°†åœ¨åç»­ç‰ˆæœ¬ä¸­æä¾›')
}

// ç”Ÿå‘½å‘¨æœŸ
onMounted(() => {
  loadSettings()
})
</script>

<style scoped>
.settings-view {
  @apply min-h-screen bg-gray-50 py-8;
}

.settings-container {
  @apply max-w-4xl mx-auto px-6;
}

.settings-title {
  @apply text-3xl font-bold text-center text-gray-800 mb-8;
}

.settings-content {
  @apply space-y-8;
}

.settings-section {
  @apply bg-white rounded-lg shadow-md p-6;
}

.section-title {
  @apply text-xl font-semibold text-gray-800 mb-6 pb-2 border-b border-gray-200;
}

.settings-grid {
  @apply space-y-6;
}

.setting-item {
  @apply flex flex-col;
}

.setting-label {
  @apply text-sm font-medium text-gray-700 mb-2 flex items-center cursor-pointer;
}

.setting-checkbox {
  @apply mr-2;
}

.setting-select, .setting-range {
  @apply w-full max-w-xs;
}

.setting-select {
  @apply px-3 py-2 border border-gray-300 rounded-md;
  @apply focus:outline-none focus:ring-2 focus:ring-blue-500;
}

.setting-range {
  @apply appearance-none h-2 bg-gray-200 rounded-lg cursor-pointer;
}

.setting-description {
  @apply text-xs text-gray-500 mt-1;
}

.volume-control {
  @apply flex items-center space-x-3;
}

.volume-value {
  @apply text-sm text-gray-600 min-w-12;
}

.data-actions {
  @apply flex flex-wrap gap-3 mt-6 pt-6 border-t border-gray-200;
}

.data-btn {
  @apply px-4 py-2 text-sm font-medium rounded-md transition-colors duration-200;
  @apply bg-gray-100 text-gray-700 hover:bg-gray-200;
}

.data-btn.danger {
  @apply bg-red-500 text-white hover:bg-red-600;
}

.about-info {
  @apply flex flex-col md:flex-row justify-between items-start md:items-center;
}

.app-info h3 {
  @apply text-lg font-semibold text-gray-800 mb-2;
}

.app-info p {
  @apply text-sm text-gray-600 mb-1;
}

.about-links {
  @apply flex space-x-3 mt-4 md:mt-0;
}

.link-btn {
  @apply px-3 py-1 text-sm bg-blue-100 text-blue-700 rounded;
  @apply hover:bg-blue-200 transition-colors duration-200;
}

.settings-footer {
  @apply flex justify-end space-x-3 mt-8 pt-6 border-t border-gray-200;
}

.footer-btn {
  @apply px-6 py-2 text-sm font-medium rounded-md transition-colors duration-200;
  @apply bg-gray-100 text-gray-700 hover:bg-gray-200;
}

.footer-btn.primary {
  @apply bg-blue-500 text-white hover:bg-blue-600;
}
</style>
